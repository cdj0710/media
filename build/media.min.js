!function(){function e(r){if(r=Object.assign({id:"",width:750,height:0,isDebug:!1,immediate:!0,compress:!0,type:1,success:function(){},fail:function(){}},r),null==document.getElementById(r.id)&&r.fail("参数错误：id值未传入！"),null==document.getElementById("inputBox")){var e=document.createElement("div");e.id="inputBox",document.body.append(e)}else e=document.getElementById("inputBox");1==r.type?r.immediate?(acceptAttr='accept="image/*,camera"',capturetAttr='capture="camera"'):(acceptAttr='accept="image/*"',capturetAttr=""):2==r.type&&(r.immediate?(acceptAttr='accept="video/*,camera"',capturetAttr='capture="camera"'):(acceptAttr='accept="video/*"',capturetAttr="")),e.innerHTML='<input id="mediaInput" onchange="mediaInputChange()" type="file" '+acceptAttr+" "+capturetAttr+' style="border: none;color: #FFF;height: 0px;width:0px;left: -1000em;">',window.mediaInputChange=function(){var e=document.getElementById("mediaInput").files[0],t=document.getElementById(r.id);if(console.log(t),console.log(e),!r.immediate||r.isDebug||c(e,r.type))if(r.compress&&1==r.type){var a=new d(e),i=0;o()&&(i=6),a.render(t,{maxWidth:r.width,quality:1,orientation:i},function(){r.success(s(t.src))})}else{var n=new FileReader;n.readAsDataURL(e),n.onload=function(){t.src=this.result,r.success(e)}}}}e.prototype.start=function(){document.getElementById("mediaInput").click()};var o=function(){return!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)},c=function(e,t){if(e){var a=e.name,i=(e.size,e.type),n=(new Date).getTime(),r=e.lastModified;return console.log(e),console.log("name:"+a),console.log("lastModified:"+e.lastModified),console.log("lastModifiedDate:"+e.lastModifiedDate),console.log(n-r),1==t?-1==i.indexOf("image")?(alert("上传文件格式不正确"),!1):4e3<n-r?(alert("不能选择相册文件"),!1):!o()||-1!=a.indexOf("image.")||(alert("不能选择相册文件"),!1):2==t?-1==i.indexOf("video")?(alert("上传文件格式不正确"),!1):2e4<n-r?(alert("请实时拍摄一段单向视频"),!1):!(o()&&-1<a.indexOf("trim."))||(alert("请实时拍摄一段单向视频"),!1):void 0}},s=function(e){for(var t=e.split(","),a=t[0].match(/:(.*?);/)[1],i=atob(t[1]),n=i.length,r=new Uint8Array(n);n--;)r[n]=i.charCodeAt(n);return new Blob([r],{type:a})};function v(e,t,a,i){var n=e.naturalWidth,r=e.naturalHeight;if(n+r){var o=a.width,c=a.height,s=t.getContext("2d");s.save(),function(e,t,a,i,n){switch(n){case 5:case 6:case 7:case 8:e.width=i,e.height=a;break;default:e.width=a,e.height=i}switch(n){case 2:t.translate(a,0),t.scale(-1,1);break;case 3:t.translate(a,i),t.rotate(Math.PI);break;case 4:t.translate(0,i),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-i);break;case 7:t.rotate(.5*Math.PI),t.translate(a,-i),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-a,0)}}(t,s,o,c,a.orientation),function(e){var t=e.naturalWidth;if(1048576<t*e.naturalHeight){var a=document.createElement("canvas");a.width=a.height=1;var i=a.getContext("2d");return i.drawImage(e,1-t,0),0===i.getImageData(0,0,1,1).data[3]}return!1}(e)&&(n/=2,r/=2);var d=1024,l=document.createElement("canvas");l.width=l.height=d;for(var u=l.getContext("2d"),h=i?function(e,t,a){var i=document.createElement("canvas");i.width=1,i.height=a;var n=i.getContext("2d");n.drawImage(e,0,0);for(var r=n.getImageData(0,0,1,a).data,o=0,c=a,s=a;o<s;)0===r[4*(s-1)+3]?c=s:o=s,s=c+o>>1;var d=s/a;return 0===d?1:d}(e,0,r):1,m=Math.ceil(d*o/n),g=Math.ceil(d*c/r/h),f=0,p=0;f<r;){for(var w=0,v=0;w<n;)u.clearRect(0,0,d,d),u.drawImage(e,-w,-f),s.drawImage(l,0,0,d,d,v,p,m,g),w+=d,v+=m;f+=d,p+=g}s.restore(),l=u=null}}var b=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;function d(e){if(window.Blob&&e instanceof Blob){if(!b)throw Error("No createObjectURL function found to create blob url");var t=new Image;t.src=b.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var i=this;e.onload=e.onerror=function(){var e=i.imageLoadListeners;if(e){i.imageLoadListeners=null;for(var t=0,a=e.length;t<a;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}d.prototype.render=function(e,t,a){if(this.imageLoadListeners){var i=this;this.imageLoadListeners.push(function(){i.render(e,t,a)})}else{t=t||{};var n=this.srcImage.naturalWidth,r=this.srcImage.naturalHeight,o=t.width,c=t.height,s=t.maxWidth,d=t.maxHeight,l=!this.blob||"image/jpeg"===this.blob.type;o&&!c?c=r*o/n<<0:c&&!o?o=n*c/r<<0:(o=n,c=r),s&&s<o&&(c=r*(o=s)/n<<0),d&&d<c&&(o=n*(c=d)/r<<0);var u={width:o,height:c};for(var h in t)u[h]=t[h];var m,g,f,p,w=e.tagName.toLowerCase();"img"===w?e.src=(m=this.srcImage,g=u,f=l,p=document.createElement("canvas"),v(m,p,g,f),p.toDataURL("image/jpeg",g.quality||.8)):"canvas"===w&&v(this.srcImage,e,u,l),"function"==typeof this.onrender&&this.onrender(e),a&&a(),this.blob&&(this.blob=null,b.revokeObjectURL(this.srcImage.src))}},"function"==typeof define&&define.amd?define([],function(){return e}):"object"==typeof exports?module.exports=e:this.Media=e}();